#include <iostream> //BIBLIOTECAS UTILIZADAS
#include <tchar.h>
#include <windows.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>

#define  TAMDISCIPLINA 10//CONSTANTES UTILIZADAS
#define  TAMALUNOS 10
#define  TAMTURMA 50
#define TAMPKEY 30
using namespace std;

HANDLE console = GetStdHandle(STD_OUTPUT_HANDLE);
COORD CursorPosition;

void gotoxy(int x, int y){
 CursorPosition.X = x; // Locates column
 CursorPosition.Y = y; // Locates Row
 SetConsoleCursorPosition(console,CursorPosition); // Sets position for next thing to be printed
}

typedef struct {
   char	nome[60];
   int carga_h, numero;
}Disciplina;

typedef struct {
   char	situacao[10], matricula_a_t[30];
   int ano, faltas, disc;
   float nota[4];
}Turma;

typedef struct {
   char	nome[60], sexo[10], matricula_a[30];
}Aluno;

Aluno alunos[TAMALUNOS];
Turma turmas [TAMTURMA];
Disciplina disciplinas[TAMDISCIPLINA];
int cont_aluno, cont_turma, cont_disciplina;


void ler_aluno_arquivo() {

    FILE *pont_arq;
    int cont = 0;
    pont_arq = fopen("aluno.txt", "r");
    if(pont_arq){
        while(fscanf(pont_arq ,"%s%s%s", alunos[cont].matricula_a, alunos[cont].nome, alunos[cont].sexo) != EOF) {
            cont++;
            cont_aluno++;
        }
        fclose(pont_arq);
    }
    else
        printf("\nERRO ao abrir arquivo!\n");
 }

void gravar_aluno_arquivo() {
    FILE *pont_arq;
    int i;
    pont_arq = fopen("aluno.txt", "w");
    if(pont_arq) {
        for(int pos = 0; pos < cont_aluno; pos++) {
            fprintf(pont_arq, "%s \n", alunos[pos].matricula_a);
            fprintf(pont_arq, "%s \n", alunos[pos].nome);
            fprintf(pont_arq, "%s \n", alunos[pos].sexo);
        }
        fclose(pont_arq);
    } else {
        printf("\nERRO ao abrir arquivo!\n");
    }
}

int pergunta(){
    int op;
     while(op != 4){
        cout<<"\n1-Aluno\n2-Disciplina\n3-Voltar\n:";
        cin >> op;
        switch(op){
            case 1:
                return op;
                break;
            case 2:
                return op;
                break;
            case 3:
                break;
                default:
                    cout<<"Opção inválida, tente novamente!\n:";
                    break;
            }
    }
}

void cadastrar_aluno(){
    cout<<"\t---CADASTRO DE ALUNO---: ";
    int sair = 0, contador;
    char pkey[TAMPKEY];
    while(sair != 1) {
        cout<<"\nMatrícula: ";
        scanf(" %[^\n]", pkey);
        for(contador = 0; contador <= cont_aluno; contador++){
            if(strcmp(alunos[contador].matricula_a, pkey)!=0){
                if(contador == cont_aluno) {
                   strcpy(alunos[contador].matricula_a, pkey);
                sair = 1;
                }
            } else {
                cout << "Matrícula já existe!";
                sair = 0;
                break;
            }
        }
    }
    cout<<"\nNome:";
    scanf(" %[^\n]",alunos[cont_aluno].nome);
    cout<<"\nSexo:";
    scanf(" %[^\n]",alunos[cont_aluno].sexo);
    cout<<"\n\tALUNO CADASTRADO!!";
    cont_aluno++;
}

void cadastrar_disciplina(){
    cout<<"\t---CADASTRO DE DISCIPLINA---: ";
    int sair = 0, contador;
    int compara;
    while(sair != 1) {
        cout<<"\nNúmero da Disciplina: ";
        cin>>compara;
        for(contador = 0; contador <= cont_disciplina; contador++){
                if(disciplinas[contador].numero!=compara){
                if(contador == cont_disciplina) {
                   disciplinas[contador].numero=compara;
                sair = 1;
                }
            } else {
                cout << "Número já existe!";
                sair = 0;
                break;
            }
        }
    }
    cout<<"\nCarga horária:";
    cin>>disciplinas[cont_disciplina].carga_h;
    cout<<"\nNome:";
    scanf(" %[^\n]",disciplinas[cont_disciplina].nome);
    cout<<"\n\tDISCIPLINA CADASTRADA!!";
    cont_disciplina++;
}

int escolher_disciplina(){
    int cont, escolha;
    cout<<"Número das disciplinas:\n";
    for(cont=0;cont<cont_disciplina;cont++){
        cout<<disciplinas[cont].numero<<"\n";
    }
    cin>>escolha;
    return escolha;
}

void cadastrar_turma(){
    cout<<"\t---CADASTRO DE TURMA---: ";
    float soma=0;
    int sair = 0, contador;
    int compara;
    char pkey[TAMPKEY];
    while(sair != 1) {
            if(cont_aluno==0){
                cadastrar_aluno();
            }
        cout<<"\nMatrícula do aluno: ";
        scanf(" %[^\n]", pkey);
        for(contador = 0; contador <= cont_aluno; contador++){
            if(strcmp(alunos[contador].matricula_a, pkey)==0){
                   strcpy(turmas[cont_turma].matricula_a_t, pkey);
                 sair = 1;
                }
            if(contador==cont_aluno) {
                cout << "Matrícula não existe!\n";
                sair = 0;
                break;
            }
          }
        }
        sair=0;
         if(cont_disciplina==0){
                cadastrar_disciplina();
            }
        while(sair != 1) {
        cout<<"\nNúmero da Disciplina: ";
        cin>>compara;
        for(contador = 0; contador <= cont_disciplina; contador++){
                if(disciplinas[contador].numero==compara){
                   turmas[cont_turma].disc=compara;
                sair = 1;
            } if(contador==cont_disciplina){
                cout << "Número não existe existe!";
                sair = 0;
                break;
            }
        }
    }
   cout<<"Ano letivo:\n";
   cin>>turmas[cont_turma].ano;
   for(contador=0;contador<3;contador++){
    printf("Nota %d :\n", contador);
    cin>>turmas[cont_turma].nota[contador];
   }
   for(contador=0;contador<3;contador++){
    soma=soma+turmas[cont_turma].nota[contador];
   }
   soma=soma/3;
   turmas[cont_turma].nota[3]=soma;
   if(turmas[cont_turma].nota[3]<6){
    strcpy(turmas[cont_turma].situacao, "reprovado");
   }else{
       strcpy(turmas[cont_turma].situacao, "aprovado");
   }
   cout<<"Faltas:\n";
   cin>>turmas[cont_turma].faltas;
    cout<<"\n\tTURMA CADASTRADA!!";
    cont_turma++;
}

int buscar_aluno(){
    int contador;
    char matricula_compara[TAMPKEY];
    cout<<"\n\tInforme a matrícula  do funcionário\n: ";
                scanf(" %[^\n]",matricula_compara);
      for(contador = 0; contador < cont_aluno; contador++){
                    if(strcmp(alunos[contador].matricula_a, matricula_compara)==0){
                        system("cls");
                        return contador;
                    }
                }
}

int buscar_disciplina(){
    int contador, compara;
    char matricula_compara[TAMPKEY];
    cout<<"\n\tInforme o numero da disciplina\n: ";
                cin>>compara;
      for(contador = 0; contador < cont_aluno; contador++){
                    if(compara==disciplinas[contador].numero){
                        system("cls");
                        return contador;
                    }
                }
}


void excluir_aluno(int pos) {
    int i;
    for(int i = pos; i <= cont_aluno; i++) {
            if(i==cont_aluno){
            strcpy(alunos[i].matricula_a,"");
            strcpy(alunos[i].nome, "");
            strcpy(alunos[i].sexo, "");
            }else{
            alunos[i]=alunos[i+1];
            }
    }
    cout << "aluno excluído com sucesso!";
    cont_aluno--;
}


void excluir_disciplina(int pos) {
    int i;
    for(int i = pos; i <=cont_disciplina; i++) {
            if(i==cont_disciplina){
            disciplinas[i].numero=0;
            strcpy(disciplinas[i].nome,"");
           disciplinas[i].carga_h=0;
            }else{
            disciplinas[i]=disciplinas[i+1];
            }
    }
    cout << "Disciplina excluída com sucesso!";
    cont_disciplina--;
}
void exibe(){
    int op,cont, cont2;
              while(op != 5){
        cout<<"aluno-1\nturma-2\ndisiplina-3\n:";
        cin >> op;
        switch(op){
            case 1:
                for(cont=0;cont<cont_aluno;cont++){
                        cout<<"Aluno "<<cont+1<<"------\n";
         cout<<"matricula :"<< alunos[cont].matricula_a<<"\n";
         cout<<"nome :"<< alunos[cont].nome<<"\n";
         cout<<"sexo kkk :"<< alunos[cont].sexo<<"\n";
         }
                break;
                op=5;
            case 2:
               for(cont=0;cont<cont_turma;cont++){
                      cout<<"turma "<<cont+1<<"------\n";
         cout<<"disciplina :"<< turmas[cont].disc<<"\n";
         cout<<"aluno mat :"<< turmas[cont].matricula_a_t<<"\n";
         cout<<"ano :"<< turmas[cont].ano<<"\n";
         for(cont2=0;cont2<4;cont2++){
                if(cont2==3){
               cout<<"media :"<<turmas[cont].nota[cont2];
             }else{
             cout<<"nota "<<cont2<<": "<<turmas[cont].nota[cont2];
          }
         }
          cout<<"situacao :"<< turmas[cont].situacao<<"\n";
           cout<<"faltas :"<< turmas[cont].faltas<<"\n";
               }
                break;
                 op=5;
            case 3:
                for(cont=0;cont<cont_disciplina;cont++){
                        cout<<"Disciplina"<<cont+1<<"------\n";
         cout<<"num :"<< disciplinas[cont].numero<<"\n";
         cout<<"nome :"<< disciplinas[cont].nome<<"\n";
         cout<<"CH :"<< disciplinas[cont].carga_h<<"\n";
         }
                break;
                 op=5;
                default:
                    cout<<"Opção inválida, tente novamente!\n:";
                    break;
    }
    break;
}

}

void altera_aluno(int pos){
    cout<<"\nNome:";
    scanf(" %[^\n]",alunos[pos].nome);
    cout<<"\nSexo:";
    scanf(" %[^\n]",alunos[pos].sexo);
    cout<<"\n\tALUNO RECADASTRADO!!";
}

void altera_disciplina(int pos){
    cout<<"\nCarga horária:";
    cin>>disciplinas[pos].carga_h;
    cout<<"\nNome:";
    scanf(" %[^\n]",disciplinas[pos].nome);
    cout<<"\n\tDISCIPLINA RECADASTRADA!!";
}

void menu(){
    int opcao=7, op2;
    while(opcao != 0) {
        cout << "\nSair-[0]\ncadastrar [1] \nalterar [2]\nexcluir[3]\nExibir[4]:";
       scanf("%d", &opcao);
        switch(opcao) {
             case 0:
             cout << "Tchau";
            break;
        case 1:
            system("cls");
            while(op2 <1 || op2>3){
            cout<<"O que quer cadastrar?\n";
             cout<<"aluno-1\ndisciplina-2\nturma-3\n:";
             cin>>op2;
            }
            if(op2==1){
                cadastrar_aluno();
            }
             if(op2==2){
                cadastrar_disciplina();
            }
             if(op2==3){
                cadastrar_turma();
            }
            break;
        case 2:
            system("cls");
            cout<<"O que quer alterar?\n";
            cout<<"aluno-1\ndisciplina-2\n:";
            if(op2==1){
                altera_aluno(buscar_aluno());
            }
             if(op2==2){
                altera_disciplina(buscar_disciplina());
            }
            break;
        case 3:
             system("cls");
              cout<<"\nO que quer excluir?\n";
            op2=pergunta();
            if(op2==1){
                excluir_aluno(buscar_aluno());
            }
             if(op2==2){
                excluir_disciplina(buscar_disciplina());
            }
            break;
        case 4:
            exibe();
            break;
        default:
            cout << "Opção inválida! ";
            break;
        }
    }
}

main(){
    setlocale( LC_ALL, "portuguese" );
    ler_aluno_arquivo();
    menu();
    gravar_aluno_arquivo();
}
